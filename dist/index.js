"use strict";function __classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function __classPrivateFieldSet(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i}var e,t,i,s,r,a,l;Object.defineProperty(exports,"__esModule",{value:!0});class EventIterator{constructor(n,h,d={}){Object.defineProperty(this,"emitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"event",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.set(this,!1),t.set(this,void 0),i.set(this,[]),s.set(this,0),r.set(this,void 0),a.set(this,null),l.set(this,void 0),this.emitter=n,this.event=h,__classPrivateFieldSet(this,r,d.limit??1/0),__classPrivateFieldSet(this,t,d.idle),this.filter=d.filter??(()=>!0),__classPrivateFieldGet(this,t)&&__classPrivateFieldSet(this,a,setTimeout(this.end.bind(this),__classPrivateFieldGet(this,t))),__classPrivateFieldSet(this,l,this.push.bind(this));const o=this.emitter.getMaxListeners();0!==o&&this.emitter.setMaxListeners(o+1),this.emitter.on(this.event,__classPrivateFieldGet(this,l))}get ended(){return __classPrivateFieldGet(this,e)}end(){if(__classPrivateFieldGet(this,e))return;__classPrivateFieldSet(this,e,!0),__classPrivateFieldSet(this,i,[]),this.emitter.off(this.event,__classPrivateFieldGet(this,l));const t=this.emitter.getMaxListeners();0!==t&&this.emitter.setMaxListeners(t-1)}async next(){if(__classPrivateFieldGet(this,i).length){const e=__classPrivateFieldGet(this,i).shift();return this.filter(e)?(__classPrivateFieldSet(this,s,+__classPrivateFieldGet(this,s)+1)>=__classPrivateFieldGet(this,r)&&this.end(),__classPrivateFieldGet(this,a)&&__classPrivateFieldGet(this,a).refresh(),{done:!1,value:e}):this.next()}return __classPrivateFieldGet(this,e)?(__classPrivateFieldGet(this,a)&&clearTimeout(__classPrivateFieldGet(this,a)),{done:!0,value:void 0}):new Promise((e=>{let i=null;__classPrivateFieldGet(this,t)&&(i=setTimeout((()=>{this.end(),e(this.next())}),__classPrivateFieldGet(this,t))),this.emitter.once(this.event,(()=>{i&&clearTimeout(i),e(this.next())}))}))}return(){return this.end(),Promise.resolve({done:!0,value:void 0})}throw(){return this.end(),Promise.resolve({done:!0,value:void 0})}[(e=new WeakMap,t=new WeakMap,i=new WeakMap,s=new WeakMap,r=new WeakMap,a=new WeakMap,l=new WeakMap,Symbol.asyncIterator)](){return this}push(...e){__classPrivateFieldGet(this,i).push(e)}}exports.EventIterator=EventIterator;
//# sourceMappingURL=index.js.map
